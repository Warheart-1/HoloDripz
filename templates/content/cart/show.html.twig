{% extends 'base.html.twig' %}

{% block body %}
{% for cartProduct in cartProducts %}

    Name : {{ cartProduct.product.name }} - Price : {{ cartProduct.product.price }} - Quantity : {{ cartProduct.quantity }} - Total : {{ cartProduct.product.price * cartProduct.quantity }}

    <select data-id="{{ cartProduct.id }}" data-class="quantityValue">
            {% for i in range(1, 10) %}

                <option value="{{ i }}" {% if i == cartProduct.quantity %}selected{% endif %}>{{ i }}</option>
    
            {% endfor %}
    </select>
    <button data-id="{{ cartProduct.id }}" data-class="deleteProduct">Delete</button>

{% endfor %}


{% block javascript %}

    <script>

        const selectorQuantity =  document.querySelectorAll('[data-class="quantityValue"]');
        selectorQuantity.forEach((element) => {
            element.addEventListener('change', async (event) => {
                event.preventDefault();
                const url = '/cart/update'
                const data = {
                    quantity: event.target.value,
                    id: event.target.dataset.id
                }
                const response = await fetchQuantity(url, JSON.stringify(data), 'POST', 'Content-Type : application/json');
                console.log(response);
                const quantity = await response.json();
                console.log(quantity);

            });
        });

        const selectorDelete =  document.querySelectorAll('[data-class="deleteProduct"]');

        selectorDelete.forEach((element) => {
            element.addEventListener('click', async (event) => {
                event.preventDefault();
                const url = '/cart/delete'
                const data = {
                    id: event.target.dataset.id
                }
                if(!confirm('Are you sure you want to delete this product ?')) {
                    return;
                }
                const response = await fetchQuantity(url, JSON.stringify(data), 'POST', 'Content-Type : application/json');
                console.log(response);
                const quantity = await response.json();
                console.log(quantity);

            });
        });

        async function fetchQuantity(url, data = null, method, headers) {
            const response = await fetch(url, {
                method: method,
                headers: {
                    headers,
                },
                body: data
            });
            return response;
        }

    </script>
    
{% endblock %}

{% endblock %}



